# javascript 引擎 V8

## 1.V8

1. ![js设计思想](https://github.com/bearnew/picture/blob/master/markdown_v2/2021/javascript%E5%BC%95%E6%93%8Ev8/js%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3.PNG?raw=true)
2. ![V8编译流水线](https://github.com/bearnew/picture/blob/master/markdown_v2/2021/javascript%E5%BC%95%E6%93%8Ev8/V8%E7%BC%96%E8%AF%91%E6%B5%81%E6%B0%B4%E7%BA%BF.PNG?raw=true)
3. `V8` 是一个由 `Google` 开发的开源 `JavaScript` 引擎，目前用在 `Chrome` 浏览器和 `Node.js`中，其核心功能是执行易于人类理解的 `JavaScript` 代码。
   - 苹果公司在 `Safari` 中就是用 `JavaScriptCore` 虚拟机
   - `Firefox` 使用了`TraceMonkey` 虚拟机
   - `Chrome` 则使用了 `V8` 虚拟机
4. `V8`在编译阶段将`js`代码转换成机器能够理解的机器代码，在执行阶段执行转换后的代码并输出执行结果
5. 计算机只能识别二进制指令，所以要让计算机执行一段高级语言通常有两种手段，第一种是将高级代码转换为二进制代码，再让计算机去执行；另外一种方式是在计算机安装一个解释器，并由解释器来解释执行。
6. V8 并没有采用某种单一的技术，而是混合编译执行和解释执行这两种手段，我们把这种混合使用编译器和解释器的技术称为 JIT（Just In Time）技术。
7. 解释执行的启动速度快，但是执行时的速度慢，而编译执行的启动速度慢，但是执行时的速度快
8. v8 优先采用解释执行策略，如果某段代码的执行频率超过一个值，V8 采用优化编译器将代码编译成执行效率更高效的机器代码
9. V8 执行 js 的流程
   1. 初始化基础环境
   2. 解析源码生成 AST 和作用域
   3. 依据 AST 和作用域生成字节码
   4. 解释执行字节码
   5. 监听热点代码
   6. 优化热点代码为二进制的机器代码
   7. 反优化生成的二进制的机器代码（V8 是一门动态语言，在运行过程中，某些被优化的结构可能会被 JavaScript 动态修改了，这会导致之前被优化的代码失效，如果某块优化之后的代码失效了，那么编译器需要执行反优化操作）

## 2.js 函数即对象

1. js 中的函数是一种特殊的对象，js 中的函数称为一等公民
2. js 不是一门面向对象的语言，面向对象语言天生支持封装、继承、多态，但是 `JavaScript` 并没有直接提供多态的支持
3. 函数除了可以拥有常用类型的属性值之外，还拥有两个隐藏属性，分别是 `name` 属性和 `code` 属性。
4. 函数对象的默认的 `name` 属性值就是 `anonymous`，表示该函数对象没有被设置名称。
5. 另一个隐藏属性是 `code` 属性，其值表示函数代码，以字符串的形式存储在内存中。当执行到一个函数调用语句时，`V8` 便会从函数对象中取出 `code` 属性值，也就是函数代码，然后再解释执行这段函数代码。
